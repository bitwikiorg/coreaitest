<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORE AI - Admin Panel</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/terminal.css">
</head>
<body>
    <%- include('partials/navbar', {active: 'admin'}); %>

    <div class="container">
        <div class="terminal-container">

            <%- include('partials/page-header', {title: 'ADMIN PANEL v1.0'}); %>

            <div class="admin-content">
                <!-- Status Section - Moved to Top -->
                <div class="config-section">
                    <div class="config-header">[ SYSTEM STATUS ]</div>
                </div>

                <div class="config-section">
                    <div class="config-header">[ CONNECTION STATUS ]</div>
                    <div class="system-status">
                        <div class="status-item">
                            <span class="status-label">VENICE AI:</span>
                            <span class="status-value" id="venice-status">CHECKING...</span>
                            <span class="connection-details" id="venice-details"></span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">BRAVE SEARCH:</span>
                            <span class="status-value" id="search-status">CHECKING...</span>
                            <span class="connection-details" id="search-details"></span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">GITHUB:</span>
                            <span class="status-value" id="github-status">CHECKING...</span>
                            <span class="connection-details" id="github-details"></span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">MEMORY SYSTEM:</span>
                            <span class="status-value" id="storage-status">CHECKING...</span>
                            <span class="connection-details" id="storage-details"></span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">LOCAL CACHE:</span>
                            <span class="status-value active">ACTIVE</span>
                            <span class="connection-details">Short-term working memory</span>
                        </div>
                    </div>
                </div>

                <!-- System Logs - Moved Near Top -->
                <div class="config-section">
                    <div class="config-header">[ SYSTEM LOGS ]</div>
                    <div class="system-log" id="system-log">
                        <div class="log-entry">[SYSTEM] Admin panel initialized.</div>
                        <div class="log-entry">[SYSTEM] Checking API connections...</div>
                    </div>
                    <div class="button-group">
                        <button class="admin-btn" id="refresh-status">[REFRESH STATUS]</button>
                        <button class="admin-btn" id="clear-logs">[CLEAR LOGS]</button>
                    </div>
                </div>

                <!-- Active Plugins Section -->
                <div class="config-section">
                    <div class="config-header">[ ACTIVE PLUGINS ]</div>
                    <div class="plugin-list" id="plugin-list">
                        <div class="plugin-item">
                            <span class="plugin-name">Core AI</span>
                            <span class="plugin-status active">ACTIVE</span>
                        </div>
                        <div class="plugin-item">
                            <span class="plugin-name">Venice AI</span>
                            <span class="plugin-status" id="venice-plugin-status">LOADING...</span>
                        </div>
                        <div class="plugin-item">
                            <span class="plugin-name">GitHub Integration</span>
                            <span class="plugin-status" id="github-plugin-status">LOADING...</span>
                        </div>
                        <div class="plugin-item">
                            <span class="plugin-name">Bootstrap</span>
                            <span class="plugin-status active">ACTIVE</span>
                        </div>
                    </div>
                </div> <!-- End of Active Plugins section -->

                <!-- API Configuration -->
                <div class="config-section">
                    <div class="config-header">[ API CONFIGURATION ]</div>

                    <!-- Venice AI Section -->
                    <div class="subcategory">
                        <div class="config-header">[ VENICE AI API - LANGUAGE MODELS ]</div>
                        <div class="config-description">Powers text generation, research analysis, and semantic reasoning capabilities</div>
                        <div class="config-form">
                            <div class="config-item">
                                <label>API KEY:</label>
                                <input type="password" id="venice-api-key" placeholder="*************">
                                <button class="admin-btn" id="save-venice-key">[SAVE]</button>
                            </div>
                        </div>
                    </div>

                    <!-- Brave Search Section -->
                    <div class="subcategory">
                        <div class="config-header">[ BRAVE SEARCH API - WEB SEARCH ]</div>
                        <div class="config-description">Enables privacy-focused web search capabilities for research</div>
                        <div class="config-form">
                            <div class="config-item">
                                <label>API KEY:</label>
                                <input type="password" id="brave-api-key" placeholder="*************">
                                <button class="admin-btn" id="save-brave-key">[SAVE]</button>
                            </div>
                        </div>
                    </div>
                </div> <!-- End of API Configuration section -->

                <!-- GitHub Configuration - Expanded -->
                <div class="config-section">
                    <div class="config-header">[ GITHUB API - MEMORY & STORAGE ]</div>
                    <div class="config-description">Provides persistent memory and research storage through Git repositories</div>

                    <!-- GitHub Connection Status -->
                    <div class="subcategory">
                        <div class="subcategory-header">CONNECTION STATUS</div>
                        <div class="status-section">
                            <div class="status-indicator">
                                <span class="status-label">GITHUB API:</span>
                                <span class="status-value" id="github-api-status">CHECKING...</span>
                            </div>
                            <div class="status-details" id="github-status-details">
                                Verifying connection to GitHub...
                            </div>
                            <button class="admin-btn" id="verify-connection">[VERIFY CONNECTION]</button>
                        </div>
                    </div>

                    <!-- Authentication -->
                    <div class="subcategory">
                        <div class="subcategory-header">AUTHENTICATION</div>
                        <div class="config-form">
                            <div class="config-item">
                                <label>GITHUB TOKEN:</label>
                                <input type="password" id="github-token" placeholder="*************">
                                <button class="admin-btn" id="save-github-token">[SAVE]</button>
                            </div>
                        </div>
                    </div>

                    <!-- Research Repository Configuration -->
                    <div class="subcategory">
                        <div class="subcategory-header">RESEARCH REPOSITORY</div>
                        <div class="config-description">Repository for storing completed research</div>
                        <div class="config-form">
                            <div class="config-item">
                                <label>OWNER/ORGANIZATION:</label>
                                <input type="text" id="github-owner" placeholder="GitHub username or organization">
                            </div>
                            <div class="config-item">
                                <label>REPOSITORY NAME:</label>
                                <input type="text" id="github-research-repo" placeholder="e.g., ai-research-reports">
                            </div>
                            <div class="config-item">
                                <label>BRANCH:</label>
                                <input type="text" id="github-branch" placeholder="main">
                            </div>
                            <div class="config-item">
                                <label>PATH:</label>
                                <input type="text" id="github-path" placeholder="research">
                            </div>
                            <button class="admin-btn" id="save-research-repo-settings">[SAVE RESEARCH REPO CONFIG]</button>
                        </div>
                    </div>

                    <!-- Memory Repository Configuration -->
                    <div class="subcategory">
                        <div class="subcategory-header">MEMORY REPOSITORY</div>
                        <div class="config-description">Repository for AI's working memory and notes</div>
                        <div class="config-form">
                            <div class="config-item">
                                <label>REPOSITORY NAME:</label>
                                <input type="text" id="github-memory-repo" placeholder="e.g., ai-memory-workspace">
                            </div>
                            <div class="config-item">
                                <label>BRANCH:</label>
                                <input type="text" id="github-memory-branch" placeholder="main">
                            </div>
                            <div class="config-item">
                                <label>PATH:</label>
                                <input type="text" id="github-memory-path" placeholder="memory">
                            </div>
                            <button class="admin-btn" id="save-memory-repo-settings">[SAVE MEMORY REPO CONFIG]</button>
                        </div>
                    </div>
                </div>

                <!-- GitHub Actions Section -->
                <div class="config-section">
                    <div class="config-header">[ GITHUB ACTIONS ]</div>
                    <div class="config-description">Manage GitHub repository synchronization and uploads</div>

                    <!-- Manual Actions -->
                    <div class="actions-section">
                        <div class="action-group">
                            <button class="admin-btn" id="sync-all-research">[SYNC ALL RESEARCH]</button>
                            <div class="action-description">Bidirectional sync - first pull from GitHub, then push local files</div>
                        </div>
                        <div class="action-group">
                            <button class="admin-btn" id="upload-research-btn">[UPLOAD RESEARCH DOCUMENTS]</button>
                            <div class="action-description">Upload local research documents to the GitHub repository</div>
                        </div>
                        <div class="action-group">
                            <button class="admin-btn" id="test-github-upload">[TEST UPLOAD]</button>
                            <div class="action-description">Create a test file to verify GitHub connectivity</div>
                        </div>
                    </div>

                    <!-- Custom File Upload -->
                    <div class="subcategory">
                        <div class="subcategory-header">CUSTOM FILE UPLOAD</div>
                        <div class="custom-upload-section">
                            <div class="config-item">
                                <label>FILE PATH:</label>
                                <input type="text" id="file-path-input" placeholder="e.g., research/my-notes.md">
                                <div class="help-text">Include the full path where the file should be saved in the repository</div>
                            </div>
                            <div class="config-item">
                                <label>COMMIT MESSAGE:</label>
                                <input type="text" id="commit-message-input" placeholder="Add custom notes">
                            </div>
                            <div class="config-item">
                                <label>CONTENT:</label>
                                <textarea id="file-content-input" rows="8" placeholder="# My Notes&#10;&#10;Enter your content here..."></textarea>
                            </div>
                            <button id="upload-file-btn" class="admin-btn">[UPLOAD FILE]</button>
                            <div id="upload-result" class="upload-result"></div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="config-section">
                    <div class="config-header">[ GITHUB ACTIVITY ]</div>
                    <div class="config-description">Recent GitHub repository activity</div>

                    <div class="activity-section">
                        <div class="activity-list" id="github-activity">
                            <div class="activity-item">
                                <span class="timestamp">YYYY-MM-DD HH:MM:SS</span>
                                <span class="activity-text">Waiting for activity data...</span>
                            </div>
                        </div>
                        <button class="admin-btn" id="refresh-activity">[REFRESH ACTIVITY]</button>
                    </div>
                </div>

                <!-- Research Settings -->
                <div class="config-section">
                    <div class="config-header">[ RESEARCH SETTINGS ]</div>
                </div>

                <div class="config-section">
                    <div class="config-header">[ RESEARCH PARAMETERS ]</div>
                    <div class="config-form">
                        <div class="config-item">
                            <label>DEFAULT DEPTH:</label>
                            <input type="number" id="default-depth" value="3" min="1" max="5">
                            <div class="help-text">Controls depth of research exploration (1-5)</div>
                        </div>
                        <div class="config-item">
                            <label>DEFAULT BREADTH:</label>
                            <input type="number" id="default-breadth" value="5" min="1" max="10">
                            <div class="help-text">Controls number of parallel research paths (1-10)</div>
                        </div>
                        <div class="config-item">
                            <label>PUBLIC RESEARCH:</label>
                            <select id="public-research">
                                <option value="true">ENABLED</option>
                                <option value="false">DISABLED</option>
                            </select>
                            <div class="help-text">Make research publicly accessible</div>
                        </div>
                        <button class="admin-btn" id="save-research-settings">[SAVE RESEARCH SETTINGS]</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main admin content placeholder -->
    <div class="p-4">
      <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg p-6">
        <h1 class="text-2xl font-bold mb-4 dark:text-white">Admin Dashboard</h1>
        <p class="text-gray-600 dark:text-gray-300 mb-4">Configure and manage system components.</p>

        <!-- Settings section -->
        <div class="mb-6">
          <h2 class="text-xl font-semibold mb-2 dark:text-white">API Configuration</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
              <h3 class="font-medium dark:text-white">Venice API</h3>
              <div class="mt-2">
                <label class="block text-sm text-gray-700 dark:text-gray-300">API Key</label>
                <input type="password" id="veniceApiKey" 
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600 dark:text-white" 
                  placeholder="Enter Venice API key">
              </div>
            </div>

            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
              <h3 class="font-medium dark:text-white">Brave Search API</h3>
              <div class="mt-2">
                <label class="block text-sm text-gray-700 dark:text-gray-300">API Key</label>
                <input type="password" id="braveApiKey" 
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600 dark:text-white" 
                  placeholder="Enter Brave Search API key">
              </div>
            </div>
          </div>

          <div class="mt-4">
            <button id="saveApiConfigBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
              Save API Configuration
            </button>
          </div>
        </div>

        <!-- Mission Management Section -->
        <div class="mt-8 bg-white dark:bg-gray-800 shadow-md rounded-lg p-6">
          <h2 class="text-xl font-semibold mb-2 dark:text-white">Mission Management</h2>
          <p class="text-gray-600 dark:text-gray-300 mb-4">Create and manage automated research missions.</p>

          <div class="mb-4">
            <button id="refreshMissionsBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mr-2">
              Refresh Missions
            </button>
            <button id="createMissionBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
              Create New Mission
            </button>
          </div>

          <!-- Mission List -->
          <div id="missionsContainer" class="mt-4">
            <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-md">
              <h3 class="font-medium dark:text-white mb-2">Active Missions</h3>
              <div id="missionsList" class="space-y-2">
                <p class="text-gray-600 dark:text-gray-400 text-sm">Loading missions...</p>
              </div>
            </div>
          </div>

          <!-- Create Mission Form (initially hidden) -->
          <div id="createMissionForm" class="mt-6 bg-gray-100 dark:bg-gray-700 p-4 rounded-md hidden">
            <h3 class="font-medium dark:text-white mb-4">Create New Mission</h3>

            <div class="mb-4">
              <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Mission Title</label>
              <input type="text" id="missionTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600 dark:text-white" placeholder="Enter mission title">
            </div>

            <div class="mb-4">
              <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Priority</label>
              <select id="missionPriority" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600 dark:text-white">
                <option value="Low">Low</option>
                <option value="Medium" selected>Medium</option>
                <option value="High">High</option>
              </select>
            </div>

            <div class="mb-4">
              <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Schedule</label>
              <select id="missionSchedule" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600 dark:text-white">
                <option value="Every 5 minutes">Every 5 minutes</option>
                <option value="Hourly">Hourly</option>
                <option value="Daily" selected>Daily</option>
                <option value="Weekly">Weekly</option>
                <option value="Monthly">Monthly</option>
                <option value="As needed">As needed</option>
              </select>
            </div>

            <div class="mb-4">
              <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Research Query</label>
              <input type="text" id="researchQuery" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600 dark:text-white" placeholder='Enter research query (e.g., "quantum computing")'>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Depth</label>
                <input type="number" id="researchDepth" min="1" max="5" value="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600 dark:text-white">
              </div>
              <div>
                <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Breadth</label>
                <input type="number" id="researchBreadth" min="1" max="10" value="5" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600 dark:text-white">
              </div>
            </div>

            <div class="mb-4">
              <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Additional Description (optional)</label>
              <textarea id="missionDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600 dark:text-white" placeholder="Enter additional description"></textarea>
            </div>

            <div class="flex justify-end space-x-2">
              <button id="cancelMissionBtn" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                Cancel
              </button>
              <button id="saveMissionBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Create Mission
              </button>
            </div>
          </div>

          <!-- Mission Detail View (initially hidden) -->
          <div id="missionDetailView" class="mt-6 bg-gray-100 dark:bg-gray-700 p-4 rounded-md hidden">
            <h3 id="missionDetailTitle" class="font-medium dark:text-white mb-2">Mission Detail</h3>
            <div id="missionDetailContent" class="prose prose-sm dark:prose-invert">
              <!-- Mission details will be inserted here -->
            </div>
            <div class="mt-4 flex justify-between">
              <button id="backToMissionsBtn" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                Back to List
              </button>
              <button id="runMissionNowBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                Run Mission Now
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/admin.js"></script>
    <script src="/js/global.js"></script>
    <script src="/js/admin-mission.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Save API config
        document.getElementById('saveApiConfigBtn').addEventListener('click', function() {
          const veniceKey = document.getElementById('veniceApiKey').value;
          const braveKey = document.getElementById('braveApiKey').value;

          socket.emit('save-config', {
            venice: veniceKey,
            brave: braveKey
          });

          alert('API keys updated successfully!');
        });

        // Check API status
        socket.emit('check-api-status', {}, function(status) {
          if (status.venice) {
            document.getElementById('veniceApiKey').placeholder = '• API key set •';
          }
          if (status.brave) {
            document.getElementById('braveApiKey').placeholder = '• API key set •';
          }
        });
      });
    </script>
</body>
</html>